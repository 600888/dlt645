# DLT645åè®®å¤šè¯­è¨€å®ç°åº“

ä¸€ä¸ªåŠŸèƒ½å®Œæ•´çš„DLT645ç”µèƒ½è¡¨é€šä¿¡åè®®çš„å¤šè¯­è¨€å®ç°é¡¹ç›®ï¼ŒåŒæ—¶æ”¯æŒC++ã€Pythonå’ŒGoä¸‰ç§ç¼–ç¨‹è¯­è¨€ï¼Œæä¾›äº†ç»Ÿä¸€çš„æ¥å£å’ŒåŠŸèƒ½ã€‚

## ğŸŒ´é€šè®¯æ”¯æŒ

| åŠŸèƒ½                            | çŠ¶æ€ |
| ------------------------------- | ---- |
| **TCPå®¢æˆ·ç«¯ï¼ˆæ–¹ä¾¿é€šè®¯æµ‹è¯•ï¼‰** ğŸ¾ | âœ…    |
| **TCPæœåŠ¡ç«¯ï¼ˆæ–¹ä¾¿é€šè®¯æµ‹è¯•ï¼‰** ğŸ¾ | âœ…    |
| **RTUä¸»ç«™** ğŸ¾                   | âœ…    |
| **RTUä»ç«™** ğŸ¾                   | âœ…    |

## ğŸŒ´ åŠŸèƒ½å®Œæˆæƒ…å†µ

| åŠŸèƒ½                                           | çŠ¶æ€ |
| ---------------------------------------------- | -- |
| **è¯»ã€å†™é€šè®¯åœ°å€** ğŸ¾  | âœ…  |
| **å¹¿æ’­æ ¡æ—¶** ğŸ¾  | âœ…  |
| **ç”µèƒ½é‡** ğŸ¾  | âœ…  |
| **æœ€å¤§éœ€é‡åŠå‘ç”Ÿæ—¶é—´** ğŸ¾         | âœ… |
| **å˜é‡** ğŸ¾                | âœ… |
| **å‚å˜é‡** ğŸ¾            | âœ… |
| **äº‹ä»¶è®°å½•** ğŸ¾                 | âŒ |
| **å†»ç»“é‡** ğŸ¾               | âŒ |
| **è´Ÿè·çºªå½•** ğŸ¾           | âŒ |

å› ä¸ºæœ¬äººä½¿ç”¨DLT645åè®®éœ€æ±‚å¤§å¤šæ˜¯è¯»å–ç”µèƒ½è¡¨ä¸Šçš„ç”µèƒ½ã€éœ€é‡ã€å˜é‡ç­‰æ•°æ®ï¼Œåç»­çš„åŠŸèƒ½æš‚æ— å¼€å‘è®¡åˆ’ï¼Œå¦‚æœéœ€è¦å¯ä»¥è”ç³»æˆ‘

## é€‰æ‹©è¯­è¨€ç‰ˆæœ¬

è¯·é€‰æ‹©æ‚¨æ„Ÿå…´è¶£çš„è¯­è¨€ç‰ˆæœ¬æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£ï¼š

- C++ç‰ˆæœ¬(ç›®å‰åªæ”¯æŒLinuxå¹³å°)
- [Pythonç‰ˆæœ¬](../python/README.md)
- [Goç‰ˆæœ¬](../go/README.md)

## DLT645-2007 Protocol Implementation in C++

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„DLT645-2007ç”µèƒ½è¡¨é€šä¿¡åè®®çš„C++å®ç°ï¼Œæ”¯æŒTCPå’ŒRTUä¸¤ç§é€šä¿¡æ–¹å¼ï¼Œæä¾›äº†å®Œæ•´çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯åŠŸèƒ½ã€‚

## é¡¹ç›®ç»“æ„

```
â”œâ”€â”€ cpp/
â”‚   â”œâ”€â”€ include/         # å¤´æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ dlt645/      # DLT645åè®®ç›¸å…³å¤´æ–‡ä»¶
â”‚   â”‚       â”œâ”€â”€ common/  # é€šç”¨å·¥å…·ï¼ˆæ—¥å¿—ã€è½¬æ¢ç­‰ï¼‰
â”‚   â”‚       â”œâ”€â”€ model/   # æ•°æ®æ¨¡å‹
â”‚   â”‚       â”œâ”€â”€ protocol/ # åè®®å®ç°
â”‚   â”‚       â”œâ”€â”€ service/  # ä¸šåŠ¡æœåŠ¡
â”‚   â”‚       â””â”€â”€ transport/# ä¼ è¾“å±‚å®ç°
â”‚   â”œâ”€â”€ src/             # æºä»£ç å®ç°
â”‚   â”œâ”€â”€ example/         # ç¤ºä¾‹ç¨‹åº
â”‚   â”œâ”€â”€ third/           # ç¬¬ä¸‰æ–¹åº“
â”‚   â”œâ”€â”€ build/           # æ„å»ºç›®å½•
â”‚   â””â”€â”€ CMakeLists.txt   # CMakeæ„å»ºé…ç½®
â””â”€â”€ README_CPP.md        # C++ç‰ˆæœ¬é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

## åŠŸèƒ½ç‰¹æ€§

- å®Œæ•´å®ç°DLT645-2007åè®®çš„å¸§æ ¼å¼ã€æ ¡éªŒå’Œã€æ•°æ®ç¼–è§£ç 
- æ”¯æŒTCPå’ŒRTUä¸¤ç§é€šä¿¡æ–¹å¼
- æä¾›å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å®Œæ•´å®ç°
- æ”¯æŒå¼‚æ­¥é€šä¿¡
- å®Œå–„çš„æ—¥å¿—ç³»ç»Ÿ
- æ¨¡æ‹Ÿè®¾å¤‡æ•°æ®ï¼ˆæœåŠ¡ç«¯ï¼‰
- ç®€å•æ˜“ç”¨çš„APIæ¥å£

## ä¾èµ–é¡¹

- C++20 æ ‡å‡†
- CMake 3.16+ 
- Boost >=1.81ï¼ˆç”¨äºAsioç½‘ç»œç¼–ç¨‹ï¼‰
- spdlog æ—¥å¿—åº“ï¼ˆå·²åŒ…å«åœ¨thirdç›®å½•ï¼‰
- rapidjson ï¼ˆå·²åŒ…å«åœ¨thirdç›®å½•ï¼‰

## æ„å»ºæ­¥éª¤

1. ç¡®ä¿å·²å®‰è£…å¿…è¦çš„ä¾èµ–ï¼š
   ```bash
   # Ubuntu/Debian
   sudo apt-get install cmake libboost-all-dev
   
   # CentOS/RHEL
   sudo yum install cmake boost-devel
   
   # macOS
   brew install cmake boost
   ```

2. åˆ›å»ºæ„å»ºç›®å½•å¹¶ç¼–è¯‘é¡¹ç›®ï¼š
   ```bash
   cd cpp
   mkdir build
   cd build
   cmake ..
   make
   ```

3. å®‰è£…ï¼ˆå¯é€‰ï¼‰ï¼š
   ```bash
   sudo make install
   ```

## ä½¿ç”¨ç¤ºä¾‹

### TCPæœåŠ¡ç«¯ç¤ºä¾‹

å¯åŠ¨ä¸€ä¸ªDLT645 TCPæœåŠ¡ç«¯ï¼Œç›‘å¬æŒ‡å®šç«¯å£ï¼Œå¹¶æä¾›æ¨¡æ‹Ÿçš„ç”µèƒ½è¡¨æ•°æ®ã€‚

```bash
./bin/tcp_server_example
```

æœåŠ¡ç«¯ä¼šåœ¨ç«¯å£10521ä¸Šç›‘å¬è¿æ¥ï¼Œå¹¶å“åº”å®¢æˆ·ç«¯çš„è¯»å–è¯·æ±‚ã€‚

### TCPå®¢æˆ·ç«¯ç¤ºä¾‹

è¿æ¥åˆ°DLT645 TCPæœåŠ¡ç«¯ï¼Œè¯»å–ç”µèƒ½è¡¨æ•°æ®ã€‚

```bash
./bin/tcp_client_example
```

å®¢æˆ·ç«¯ä¼šè¿æ¥åˆ°æœ¬åœ°çš„10521ç«¯å£ï¼Œå¹¶å°è¯•è¯»å–ç”µèƒ½ã€ç”µå‹ã€ç”µæµç­‰æ•°æ®ã€‚

### RTUæœåŠ¡ç«¯ç¤ºä¾‹

å¯åŠ¨ä¸€ä¸ªDLT645 RTUæœåŠ¡ç«¯ï¼Œé€šè¿‡ä¸²å£ä¸å®¢æˆ·ç«¯é€šä¿¡ã€‚

```bash
./bin/rtu_server_example
```

æ³¨æ„ï¼šéœ€è¦æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ä»£ç ä¸­çš„ä¸²å£é…ç½®ï¼ˆç«¯å£åã€æ³¢ç‰¹ç‡ç­‰ï¼‰ã€‚

### RTUå®¢æˆ·ç«¯ç¤ºä¾‹

é€šè¿‡ä¸²å£è¿æ¥åˆ°DLT645 RTUæœåŠ¡ç«¯ï¼Œè¯»å–ç”µèƒ½è¡¨æ•°æ®ã€‚

```bash
./bin/rtu_client_example
```

æ³¨æ„ï¼šéœ€è¦æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ä»£ç ä¸­çš„ä¸²å£é…ç½®ï¼ˆç«¯å£åã€æ³¢ç‰¹ç‡ç­‰ï¼‰ã€‚

## ä»£ç ç¤ºä¾‹

### åˆ›å»ºTCPå®¢æˆ·ç«¯

```cpp
#include "dlt645/service/client_service.h"

// åˆ›å»ºTCPå®¢æˆ·ç«¯
auto client = service::ClientService::createTcpClient("127.0.0.1", 10521);

// è®¾ç½®è®¾å¤‡åœ°å€
std::array<uint8_t, 6> deviceAddr = {0x12, 0x34, 0x56, 0x78, 0x9A, 0xBC};
client->setAddress(deviceAddr);

// è®¾ç½®å¯†ç 
std::array<uint8_t, 4> password = {0x00, 0x00, 0x00, 0x00};
client->setPassword(password);

// è¿æ¥è®¾å¤‡
bool connected = client->connect();

// è¯»å–ç”µèƒ½æ•°æ®(00ç±»)
auto energyData = client->read00(0x00000001);

// è¯»å–æœ€å¤§éœ€é‡æ•°æ®(01ç±»)
auto demandData = client->read01(0x01000100);

// è¯»å–å˜é‡æ•°æ®(02ç±»)
auto variableData = client->read02(0x02010100);

// è¯»å–é€šè®¯åœ°å€
auto addressData = client->readAddress();

// å¹¿æ’­æ ¡æ—¶
client->broadcastTimeSync();

// æ–­å¼€è¿æ¥
client->disconnect();
```

### åˆ›å»ºTCPæœåŠ¡ç«¯

```cpp
#include "dlt645/service/server_service.h"

// åˆ›å»ºTCPæœåŠ¡ç«¯
auto server = service::ServerService::createTcpServer("0.0.0.0", 10521);

// æ³¨å†Œè®¾å¤‡
std::array<uint8_t, 6> deviceAddr = {0x12, 0x34, 0x56, 0x78, 0x9A, 0xBC};
server->registerDevice(deviceAddr);
server->setAddress(deviceAddr);

// è®¾ç½®å¯†ç 
std::array<uint8_t, 4> password = {0x00, 0x00, 0x00, 0x00};
server->setPassword(password);

// è®¾ç½®ç”µèƒ½é‡æ•°æ®(00ç±»)
server->set00(0x00000001, 100.5);

// è®¾ç½®å˜é‡æ•°æ®(02ç±»)
server->set02(0x02010100, 220.0);

// å¯åŠ¨æœåŠ¡
server->start();

// å½“éœ€è¦åœæ­¢æœåŠ¡æ—¶
server->stop();
```

## æ¥å£è¯´æ˜

### å®¢æˆ·ç«¯ä¸»è¦æ¥å£

- **createTcpClient**ï¼šåˆ›å»ºTCPå®¢æˆ·ç«¯è¿æ¥
- **createRtuClient**ï¼šåˆ›å»ºRTUå®¢æˆ·ç«¯è¿æ¥
- **setAddress**ï¼šè®¾ç½®è®¾å¤‡åœ°å€
- **setPassword**ï¼šè®¾ç½®è®¾å¤‡å¯†ç 
- **connect**ï¼šè¿æ¥åˆ°è®¾å¤‡
- **read00**ï¼šè¯»å–ç”µèƒ½é‡æ•°æ®(00ç±»)
- **read01**ï¼šè¯»å–æœ€å¤§éœ€é‡æ•°æ®(01ç±»)
- **read02**ï¼šè¯»å–å˜é‡æ•°æ®(02ç±»)
- **readAddress**ï¼šè¯»å–é€šè®¯åœ°å€
- **writeAddress**ï¼šå†™å…¥é€šè®¯åœ°å€
- **changePassword**ï¼šä¿®æ”¹å¯†ç 
- **broadcastTimeSync**ï¼šå¹¿æ’­æ ¡æ—¶
- **disconnect**ï¼šæ–­å¼€è¿æ¥

### æœåŠ¡ç«¯ä¸»è¦æ¥å£

- **createTcpServer**ï¼šåˆ›å»ºTCPæœåŠ¡ç«¯
- **createRtuServer**ï¼šåˆ›å»ºRTUæœåŠ¡ç«¯
- **registerDevice**ï¼šæ³¨å†Œè®¾å¤‡
- **validateDevice**ï¼šéªŒè¯è®¾å¤‡åœ°å€
- **setAddress**ï¼šè®¾ç½®è®¾å¤‡åœ°å€
- **setPassword**ï¼šè®¾ç½®è®¾å¤‡å¯†ç 
- **set00**ï¼šè®¾ç½®ç”µèƒ½é‡æ•°æ®
- **set01**ï¼šè®¾ç½®æœ€å¤§éœ€é‡åŠå‘ç”Ÿæ—¶é—´
- **set02**ï¼šè®¾ç½®å˜é‡æ•°æ®
- **start**ï¼šå¯åŠ¨æœåŠ¡
- **stop**ï¼šåœæ­¢æœåŠ¡

## æ³¨æ„äº‹é¡¹

1. RTUæ¨¡å¼éœ€è¦æ­£ç¡®é…ç½®ä¸²å£å‚æ•°ï¼ŒåŒ…æ‹¬ç«¯å£åã€æ³¢ç‰¹ç‡ã€æ•°æ®ä½ã€åœæ­¢ä½å’Œæ ¡éªŒä½
2. ç¤ºä¾‹ç¨‹åºä¸­çš„è®¾å¤‡åœ°å€å’Œå¯†ç ä½¿ç”¨äº†é»˜è®¤å€¼ï¼Œå®é™…ä½¿ç”¨æ—¶éœ€è¦æ ¹æ®è®¾å¤‡æƒ…å†µä¿®æ”¹
3. æœåŠ¡ç«¯ç¤ºä¾‹æä¾›äº†ç®€å•çš„æ¨¡æ‹Ÿæ•°æ®ï¼Œå®é™…åº”ç”¨ä¸­å¯èƒ½éœ€è¦è¿æ¥åˆ°çœŸå®çš„è®¾å¤‡æˆ–æ•°æ®åº“
4. åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¯·ç¡®ä¿æ­£ç¡®å¤„ç†å¼‚å¸¸å’Œé”™è¯¯æƒ…å†µ
5. æ¥å£å®šä¹‰å¯èƒ½ä¼šéšç€ç‰ˆæœ¬æ›´æ–°è€Œå˜åŒ–ï¼Œè¯·ä»¥æœ€æ–°çš„å¤´æ–‡ä»¶ä¸ºå‡†